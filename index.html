<!DOCTYPE html>


<html>
  <head>
    <meta charset="utf-8">
    <title>Maude Web Interface</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>


<body>

  <div class="headerstuff">
    <div>
      <h1>Maude Web Interface</h1>
    </div>
    <div>
      <p>An online gateway to The Maude Programming Languaje</p>
      <div>
        <a target="_blank" class="item" href="https://maude.cs.illinois.edu/w/images/e/e9/Maude34manual.pdf">Maude Manual</a>
        <a target="_blank" class="item" href="https://maude.cs.illinois.edu/w/index.php/The_Maude_System">The Maude System</a>
        <a class="item" href="mailto:bcarranc@ucm.es">Contact</a>
      </div>
    </div>
    <p style="margin-top: 50px;">
      To begin using Maude, enter a module and a command following The Maude System syntax and click "Submit".
    </p>
    <p>
    You can also enter a module though an uploaded file (.txt, .maude) or use one of the sugested modules in the section "Module Examples".
    </p>
  </div>

  <div class="fileInput">
    <input type="text" readonly="true" placeholder="Browse" style="font-family: monospace;">
    <input type="file" id="file" name="file" autocomplete="off" accept=".txt, .maude" onchange="fileSelected()">
  </div>

  <div class="container">
    <form id="maudeForm" onsubmit="executeMaudeCommand(event)">

      <div class="content-container">
        <label for="maude_command"></label>
        <textarea cols="60" rows="18" name="maude_module" id="maude_module" style="font-family: monospace;" placeholder="Enter your maude module here"></textarea>
        <input type="text" name="maude_command" id="maude_command" style="font-family: monospace; width: 250px; margin-top: 20px;" placeholder="Command">
        <button type="submit">Submit</button>
      </div>

      <div class="modList-container">
        <h3>Module Examples:</h3>
        <ul>
          <li onclick="fillModule('NAT')">NAT</li>
          <li onclick="fillModule('BOOL')">BOOL</li>
          <li onclick="fillModule('fmod FOO is pr NAT . op f : Nat Nat -> Nat . eq f(M:Nat, N:Nat) = M:Nat + N:Nat . endfm')">FOO</li>
          <li onclick="fillModule('fmod FOO is\n\tpr NAT .\n\n\top f : Nat Nat -> Nat .\n\teq f(M:Nat, N:Nat) = M:Nat + N:Nat .\nendfm')">Ejemplo con saltos de linea</li>
          <li onclick="fillModule('fmod PEANO is sorts PeanoNat . op 0 : -> PeanoNat [ctor] . op s : PeanoNat -> PeanoNat [ctor] . vars N M : PeanoNat . op _+_ : PeanoNat PeanoNat -> PeanoNat [assoc comm] . op _*_ : PeanoNat PeanoNat -> PeanoNat [assoc comm] . op esPositivo : PeanoNat -> Bool . eq [s1] : 0 + N = N . eq [s2] : s(N) + M = s(N + M) . eq 0 * N = 0 . eq s(N) * M = M + (N * M) . eq esPositivo(0) = false . eq esPositivo(s(N)) = true . endfm')">PEANO</li>
          <li onclick="fillModule('fmod PILA is pr NAT . sort Pila . op pila-vacia : -> Pila [ctor] . op apila : Nat Pila -> Pila [ctor] . op desapila : Pila -> Pila . vars N : Nat . vars P : Pila . endfm')">PILA</li>
          <li onclick="fillModule('mod DIE-HARD is protecting NAT . sorts Vasija ConjVasija . subsort Vasija < ConjVasija . op vasija : Nat Nat -> Vasija [ctor] . *** Capacidad / Contenido actual op __ : ConjVasija ConjVasija -> ConjVasija [ctor assoc comm] . vars M1 N1 M2 N2 : Nat . op initial : -> ConjVasija . eq initial = vasija(3, 0) vasija(5, 0) vasija(8, 0) . rl [vacia] : vasija(M1, N1) => vasija(M1, 0) . rl [llena] : vasija(M1, N1) => vasija(M1, M1) . crl [transfer1] : vasija(M1, N1) vasija(M2, N2) => vasija(M1, 0) vasija(M2, N1 + N2) if N1 + N2 <= M2 . crl [transfer2] : vasija(M1, N1) vasija(M2, N2) => vasija(M1, sd(N1 + N2, M2)) vasija(M2, M2) if N1 + N2 > M2 . endm')">DIE-HARD</li>
        </ul>
      </div>
    </form>
  </div>

  <div id="resultContainer"></div>

  <div class="footerstuff">
  <p> 
    Please be reminded that not all Maude commands are currently supported in this platform. 
  </p>
  <p>
    You can review the allowed syntax 
    <a href="https://github.com/bcarrans/maude_interface/blob/main/README.md">here</a>.
  </p>
  </div>

  <script>
    
    function fillModule(example) {
        document.getElementById("maude_module").value = example;
    }

    function fileSelected() {
      var fileInput = document.getElementById('file');
      var file = fileInput.files[0];

      if (file) {
        var reader = new FileReader();

        reader.onload = function(e) {
          var fileContent = e.target.result;
          document.getElementById('maude_module').value = fileContent;
        };

        reader.readAsText(file);
      }
    }

    function executeMaudeCommand(event) {
      event.preventDefault();

      var maudeModule = document.getElementById("maude_module").value;
      var maudeCommand = document.getElementById("maude_command").value;
      document.querySelector('button[type="submit"]').disabled = true;
      runPythonScript(maudeModule, maudeCommand);
    }

    function runPythonScript(maudeModule, maudeCommand) {
      
      var xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          document.getElementById("resultContainer").innerHTML = xhr.responseText;
          document.querySelector('button[type="submit"]').disabled = false;
        }
      };

      xhr.open("POST", "run_script.php", true);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhr.send("maude_module=" + encodeURIComponent(maudeModule) + "&maude_command=" + encodeURIComponent(maudeCommand));
    }

  </script>
  
</body>
</html>
